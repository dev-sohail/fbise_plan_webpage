<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FBISE Study Plan 2026</title>
  <style>
    :root {
      --primary: #2c5282;
      --secondary: #3182ce;
      --high: #e53e3e;
      --medium: #dd6b20;
      --light: #3182ce;
      --success: #38a169;
      --warning: #d69e2e;
      --gray: #718096;
      --light-gray: #f7fafc;
      --shadow: 0 6px 15px rgba(0,0,0,0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      color: #2c3e50;
      min-height: 100vh;
    }

    header {
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h1 { margin-bottom: 0.5rem; font-size: 2.2rem; }
    .subtitle { opacity: 0.9; font-size: 1.1rem; }

    .container {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .nav-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .date-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      text-align: center;
      flex: 1;
    }

    .nav-btn {
      padding: 0.7rem 1.4rem;
      border: none;
      border-radius: 25px;
      background: var(--secondary);
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .nav-btn:hover { background: #2b6cb0; transform: translateY(-2px); }
    .nav-btn:disabled { background: #a0aec0; cursor: not-allowed; opacity: 0.6; }

    .progress-summary {
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      border: 2px solid #e2e8f0;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      position: relative;
    }

    .card:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    
    .card.completed { opacity: 0.8; }
    .card.completed .card-header { background: var(--success); }
    
    .card.in-progress .card-header { background: var(--warning); }
    .card.pending .card-header { background: #a0aec0; }

    .card.completed::after {
      content: "‚úì";
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--success);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .card-header {
      padding: 1rem;
      color: white;
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-body { padding: 1.5rem; }
    .card-title { 
      font-size: 1.3rem; 
      margin-bottom: 0.8rem; 
      color: #2d3748;
      line-height: 1.4;
    }
    .card-desc { 
      color: var(--gray); 
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    .card-time { 
      font-weight: 600; 
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    .card-location { 
      color: var(--gray); 
      font-size: 0.9rem; 
      font-style: italic;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.2rem;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .action-btn:hover { transform: translateY(-2px); }
    .complete-btn { background: var(--success); color: white; }
    .complete-btn:hover { background: #2f855a; }
    .timer-btn { background: var(--secondary); color: white; }
    .timer-btn:hover { background: #2b6cb0; }
    .skip-btn { background: var(--gray); color: white; }
    .skip-btn:hover { background: #4a5568; }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem 2rem;
      background: rgba(255,255,255,0.8);
      border-radius: 12px;
      color: var(--gray);
      font-size: 1.2rem;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 1.5rem;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      font-size: 1.8rem;
      cursor: pointer;
      color: white;
      opacity: 0.9;
      background: none;
      border: none;
    }

    .close-btn:hover { opacity: 1; }

    .modal-body { padding: 1.5rem; }

    .timer-display {
      font-size: 3rem;
      font-weight: bold;
      text-align: center;
      color: var(--primary);
      font-family: 'Courier New', monospace;
      margin: 1.5rem 0;
      padding: 1rem;
      background: var(--light-gray);
      border-radius: 10px;
      border: 2px solid #e2e8f0;
    }

    .timer-label {
      text-align: center;
      color: var(--gray);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .pomodoro-progress {
      width: 100%;
      height: 20px;
      background: #e2e8f0;
      border-radius: 10px;
      overflow: hidden;
      margin: 1.5rem 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.3s ease;
    }

    .pomodoro-btns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin: 1.5rem 0;
    }

    .pomodoro-btn {
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .study-btn { 
      background: var(--secondary); 
      color: white;
    }
    .study-btn:hover { background: #2b6cb0; }
    .break-btn { 
      background: var(--success); 
      color: white;
    }
    .break-btn:hover { background: #2f855a; }

    .timer-controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    .timer-controls button {
      flex: 1;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pause-btn { 
      background: var(--warning); 
      color: white;
    }
    .pause-btn:hover { background: #dd6b20; }
    .stop-btn { 
      background: var(--high); 
      color: white;
    }
    .stop-btn:hover { background: #c53030; }
    .timer-controls button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .action-controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .action-controls button {
      flex: 1;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .mark-complete-btn { 
      background: var(--success); 
      color: white;
    }
    .mark-complete-btn:hover { background: #2f855a; }
    .skip-slot-btn { 
      background: var(--gray); 
      color: white;
    }
    .skip-slot-btn:hover { background: #4a5568; }

    .catch-up {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f7fafc;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
    }

    .catch-up h3 {
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .catch-up ul {
      list-style: none;
      padding: 0;
    }

    .catch-up li {
      padding: 0.8rem;
      background: white;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--warning);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .catch-up li:hover {
      background: #f0f4f8;
    }

    .catch-up .date {
      font-size: 0.85rem;
      color: var(--gray);
    }

    .sync-status {
      text-align: center;
      margin: 0.5rem 0;
      font-size: 0.9rem;
    }

    .sync-status.syncing { color: var(--warning); }
    .sync-status.success { color: var(--success); }
    .sync-status.error { color: var(--high); }

    #jsonbinStatus.syncing { color: var(--warning); }
    #jsonbinStatus.success { color: var(--success); }
    #jsonbinStatus.error { color: var(--high); }

    footer {
      text-align: center;
      padding: 2rem;
      color: var(--gray);
      margin-top: 3rem;
      border-top: 1px solid #e2e8f0;
    }

    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .nav-bar { flex-direction: column; text-align: center; }
      .pomodoro-btns, .timer-controls, .action-controls { 
        grid-template-columns: 1fr; 
        flex-direction: column;
      }
      .timer-display { font-size: 2.5rem; }
      .modal-body { padding: 1.2rem; }
      .card-actions { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header>
    <h1>FBISE Study Plan 2026</h1>
    <p class="subtitle">8-Week Intensive ‚Ä¢ Math & Physics Focus</p>
  </header>

  <div class="container">
    <div class="nav-bar">
      <button class="nav-btn" id="prevBtn">‚Üê Previous Day</button>
      <div class="date-display" id="dateDisplay"></div>
      <button class="nav-btn" id="nextBtn">Next Day ‚Üí</button>
    </div>

    <div class="progress-summary" id="progressSummary"></div>
    <div class="sync-status" id="syncStatus"></div>

    <div class="grid" id="grid"></div>

    <div class="catch-up" id="catchUp" style="display: none;">
      <h3>üìù Catch-up Suggestions</h3>
      <ul id="catchUpList"></ul>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header" id="modalHeader" style="background-color: #cbd5e0">
        <span>Study Session</span>
        <button class="close-btn" id="closeBtn">√ó</button>
      </div>
      <div class="modal-body">
        <div id="slotInfo"></div>
        
        <div class="timer-label" id="timerLabel">Ready to start</div>
        <div class="timer-display" id="timer">00:00:00</div>
        
        <div class="pomodoro-progress">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="pomodoro-btns">
          <button class="pomodoro-btn study-btn" id="studyBtn">
            üìö 45min Study
          </button>
          <button class="pomodoro-btn break-btn" id="breakBtn">
            ‚òï 15min Break
          </button>
        </div>

        <div class="timer-controls">
          <button class="pause-btn" id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
          <button class="stop-btn" id="stopBtn" disabled>‚èπÔ∏è Stop</button>
        </div>

        <div class="action-controls">
          <button class="mark-complete-btn" id="completeBtn">‚úÖ Mark Complete</button>
          <button class="skip-slot-btn" id="skipBtn">‚è≠Ô∏è Skip Slot</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    üí™ Stay consistent ‚Ä¢ Exam: February 22, 2026 | <span id="jsonbinStatus"></span>
  </footer>

  <audio id="alarmSound" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
  </audio>

  <script>
    // ==================== JSONBIN CONFIGURATION ====================
    const JSONBIN_BIN_ID = "695e48a6d0ea881f405a9596";
    const JSONBIN_API_KEY = "$2a$10$dEHxqxBlSdwt5OnypuafSOvaYjatOBcBHb6dHXRqTOs4t0qnf3AKK";

    // ==================== DATA ====================
    const schedule = [
      // Week 1
      { date: "2026-01-01", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 1 (Ex 1.1, 1.2)", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Ch 15 - Gravitation", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Kamal Nafs", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-02", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 1 (Ex 1.3, 1.4)", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "CS: Ch 1 - Computer Systems", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "English: Lingkuan Gorge", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-03", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 16 - Stat Mechanics", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 1 (Ex 1.5, Review)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Ideology", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-04", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 2 (Ex 2.1, 2.2)", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Ch 17 - SHM", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Muhshar, Maa Jee", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-05", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 18 - Diffraction", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: Population Explosion", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "CS: Ch 2 - Thinking", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-06", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 2 (Ex 2.3, 2.4)", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Pak Studies: Political Dev", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: Week 1 Math & Phy", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-07", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER DAY / REVISION / REST", desc: "HIGH FOCUS ‚Ä¢ Week 1 - Sun" }
      ]},
      // Week 2
      { date: "2026-01-08", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 2 (Ex 2.5, 2.6)", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Ch 19 - Electric Potential", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Hamd, Naat", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-09", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 20 - AC Circuits", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 2 (Ex 2.7, 2.8)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "English: Income-Tax Man", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-10", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 2 (Ex 2.9, 2.10, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "CS: Ch 3 - Programming", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Land Resources", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-11", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 21 - Quantum Physics", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 3 (Ex 3.1, 3.2)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Rustam o Sohrab", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-12", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 3 (Ex 3.3, 3.4)", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: Rubaiyat", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: Ch 1 All Subjects", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-13", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 22 - Nuclear", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Pak Studies: Vegetation & Wildlife", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "CS: Ch 4 - Data Analysis", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-14", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER DAY / REVISION / REST", desc: "HIGH FOCUS ‚Ä¢ Week 2 - Sun" }
      ]},
      // Week 3
      { date: "2026-01-15", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 3 (Ex 3.5, 3.6)", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Ch 23 - Cosmology", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Jug mein aakar", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-16", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 24 - Earth's Climate", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 3 (Ex 3.7, 3.8)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "English: The Blanket", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-17", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 3 (Ex 3.9, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "CS: Ch 5 - CS Applications", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Minerals", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-18", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Ch 25 - Medical Imaging", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 4 (Ex 4.1, 4.2)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Shaakhon par", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-19", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 4 (Ex 4.3, 4.4, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: Stay Hungry Stay Foolish", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: Ch 2 All", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-20", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Revision Ch 15-17", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Pak Studies: Industry & Trade", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "CS: Ch 6 - Computing Impacts", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-21", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER DAY / REVISION / REST", desc: "HIGH FOCUS ‚Ä¢ Week 3 - Sun" }
      ]},
      // Week 4
      { date: "2026-01-22", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 5 (Ex 5.1, 5.2, 5.3)", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Revision Ch 18-20", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Mein Roze se hun", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-23", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Numericals Practice 15-20", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 6 (Ex 6.1, 6.2)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "English: Tobacco", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-24", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 6 (Ex 6.3, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "CS: Ch 7 - Digital Literacy", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Integration", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-25", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Physics: Numericals Practice 21-25", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Math: Ch 7 (Ex 7.1, 7.2)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Shuru Qissa", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-26", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 7 (Ex 7.3, 7.4)", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: The Sea", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Tourism", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-27", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "MID-TERM REVISION: Math Ch 1-4", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "MID-TERM REVISION: Physics 15-20", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: Ch 3 All", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-28", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER / COMPREHENSIVE REVISION", desc: "HIGH FOCUS ‚Ä¢ Week 4 - Sun" }
      ]},
      // Week 5
      { date: "2026-01-29", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 7 (Ex 7.5, 7.6)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Ch 26 - Nature of Science", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Sab kahan", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-30", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 7 (Ex 7.7, 7.8)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: First Year at Harrow", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Constitution", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-01-31", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 7 (Ex 7.9, 7.10, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "CS: Ch 8 - Entrepreneurship", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Kaafi, Minar", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-01", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 8 (Ex 8.1, 8.2)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Formula Revision All", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "English: New Planet", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-02", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 8 (Ex 8.3, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Pak Studies: Rights & Duties", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: Ch 4 & 5", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-03", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 9 (Ex 9.1, 9.2)", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Past Paper A", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Insan Kamil", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-04", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER DAY / REVISION / REST", desc: "HIGH FOCUS ‚Ä¢ Week 5 - Sun" }
      ]},
      // Week 6
      { date: "2026-02-05", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 9 (Ex 9.3, Review)", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: Harvest Hymn", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Foreign Policy", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-06", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 10 (Ex 10.1, 10.2)", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Past Paper B", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Nazariya Pakistan", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-07", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Ch 10 (Review Ex 10)", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: Kaghan Valley", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Pak Studies: Intl. Organizations", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-08", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Complete Revision Ch 8-10", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Physics: Full Past Paper", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Urdu: Sitaroon se aage", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-09", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Math: Past Paper Practice", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "English: After 20 Years", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Revision: All Pak Studies", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-10", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "REVISION: Math Ch 5-7", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "REVISION: Physics Ch 21-26", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "REVISION: All Urdu Ghazals", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-11", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER DAY / REVISION / REST", desc: "HIGH FOCUS ‚Ä¢ Week 6 - Sun" }
      ]},
      // Week 7
      { date: "2026-02-12", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "TEST: Math Ch 1-5", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "TEST: Physics Ch 15-20", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Review & Mark Answers", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-13", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "TEST: English Complete", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "TEST: Pak Studies 1-6", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Review & Mark Answers", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-14", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "TEST: Math Ch 6-10", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Wed" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "TEST: Physics Ch 21-26", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Review & Mark Answers", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-15", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "TEST: Urdu Complete", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Thu" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "TEST: CS Complete", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Review & Mark Answers", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-16", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Focus: Weak Areas (Math)", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Fri" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Focus: Weak Areas (Physics)", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Past Paper Practice", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-17", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Revision: English Poems & Essays", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Sat" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Revision: Urdu Nazm & Ghazal", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Formula Revision All Subjects", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-18", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "BUFFER / FULL REVISION DAY", desc: "HIGH FOCUS ‚Ä¢ Week 7 - Sun" }
      ]},
      // Week 8 - Final Days
      { date: "2026-02-19", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Final Review: Math Key Chapters", desc: "HIGH FOCUS ‚Ä¢ Week 8 - Mon" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Final Review: Physics Key Topics", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Final Review: English", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-20", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "Final Review: Pak Studies", desc: "HIGH FOCUS ‚Ä¢ Week 8 - Tue" },
        { type: "medium", time: "02:00 PM - 03:30 PM", title: "Final Review: Urdu Complete", desc: "MEDIUM FOCUS" },
        { type: "light", time: "07:00 PM - 08:30 PM", title: "Final Review: CS", desc: "LIGHT FOCUS" }
      ]},
      { date: "2026-02-21", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "LIGHT REVIEW & CONFIDENCE BUILDING", desc: "HIGH FOCUS ‚Ä¢ Week 8 - Wed" }
      ]},
      { date: "2026-02-22", slots: [
        { type: "high", time: "09:00 AM - 11:00 AM", title: "EXAM DAY - YOU'VE GOT THIS!", desc: "HIGH FOCUS ‚Ä¢ Week 8 - Thu" }
      ]}
    ];

    // Fast lookup map - O(1) access
    const scheduleMap = new Map();
    schedule.forEach(item => scheduleMap.set(item.date, item.slots));

    // ==================== STATE ====================
    let currentDate = new Date("2026-01-06");
    let timerInterval = null;
    let remainingTime = 0;
    let isPaused = false;
    let currentSlot = null;
    let currentMode = null;
    let pomodoroCycle = 0;
    const totalCycles = 4;

    // Storage - O(1) operations with Sets
    let completedSlots = new Set();
    let skippedSlots = new Set();
    let inProgressSlot = null;

    // ==================== DOM ELEMENTS ====================
    const grid = document.getElementById('grid');
    const dateDisplay = document.getElementById('dateDisplay');
    const progressSummary = document.getElementById('progressSummary');
    const syncStatus = document.getElementById('syncStatus');
    const jsonbinStatus = document.getElementById('jsonbinStatus');
    const catchUp = document.getElementById('catchUp');
    const catchUpList = document.getElementById('catchUpList');
    const modal = document.getElementById('modal');
    const modalHeader = document.getElementById('modalHeader');
    const slotInfo = document.getElementById('slotInfo');
    const timerDisplay = document.getElementById('timer');
    const timerLabel = document.getElementById('timerLabel');
    const progressFill = document.getElementById('progressFill');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const studyBtn = document.getElementById('studyBtn');
    const breakBtn = document.getElementById('breakBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const completeBtn = document.getElementById('completeBtn');
    const skipBtn = document.getElementById('skipBtn');
    const closeBtn = document.getElementById('closeBtn');
    const alarmSound = document.getElementById('alarmSound');

    // ==================== JSONBIN FUNCTIONS ====================
    async function saveProgress() {
      const data = {
        completed: Array.from(completedSlots),
        skipped: Array.from(skippedSlots)
      };

      try {
        updateSyncStatus('syncing', 'Syncing to cloud...');
        
        const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': JSONBIN_API_KEY,
            'X-Bin-Private': 'false'
          },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          updateSyncStatus('success', 'Progress saved to cloud!');
          // Also save to localStorage as backup
          localStorage.setItem('completedSlots', JSON.stringify([...completedSlots]));
          localStorage.setItem('skippedSlots', JSON.stringify([...skippedSlots]));
        } else {
          throw new Error('Failed to save');
        }
      } catch (error) {
        console.error('Save failed:', error);
        updateSyncStatus('error', 'Cloud save failed, using local storage');
        // Fallback to localStorage
        localStorage.setItem('completedSlots', JSON.stringify([...completedSlots]));
        localStorage.setItem('skippedSlots', JSON.stringify([...skippedSlots]));
      }
    }

    async function loadProgress() {
      try {
        updateSyncStatus('syncing', 'Loading from cloud...');
        
        const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
          headers: {
            'X-Master-Key': JSONBIN_API_KEY
          }
        });

        if (response.ok) {
          const json = await response.json();
          const data = json.record;
          
          completedSlots = new Set(data.completed || []);
          skippedSlots = new Set(data.skipped || []);
          
          updateSyncStatus('success', 'Cloud data loaded!');
          renderGrid();
        } else {
          throw new Error('Failed to load');
        }
      } catch (error) {
        console.error('Load failed:', error);
        updateSyncStatus('error', 'Cloud load failed, using local data');
        // Fallback to localStorage
        completedSlots = new Set(JSON.parse(localStorage.getItem('completedSlots') || '[]'));
        skippedSlots = new Set(JSON.parse(localStorage.getItem('skippedSlots') || '[]'));
        renderGrid();
      }
    }

    function updateSyncStatus(type, message) {
      syncStatus.textContent = message;
      syncStatus.className = `sync-status ${type}`;

      // Also update header status
      jsonbinStatus.textContent = message;
      jsonbinStatus.className = type;

      // Clear success messages after 3 seconds
      if (type === 'success') {
        setTimeout(() => {
          if (syncStatus.className.includes('success')) {
            syncStatus.textContent = '';
            syncStatus.className = 'sync-status';
            jsonbinStatus.textContent = 'JSONBIN Status: Active';
            jsonbinStatus.className = '';
          }
        }, 3000);
      }
    }

    // ==================== HELPER FUNCTIONS ====================
    const formatDate = date => {
      const options = { weekday: 'long', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    };

    const getDateKey = date => date.toISOString().split('T')[0];

    const updateDateDisplay = () => {
      const dateStr = formatDate(currentDate);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const isToday = getDateKey(currentDate) === getDateKey(today);
      dateDisplay.textContent = isToday ? `üìÖ Today ‚Ä¢ ${dateStr}` : `üìÖ ${dateStr}`;
      
      // Update button states
      const minDate = new Date('2026-01-01');
      const maxDate = new Date('2026-02-22');
      prevBtn.disabled = currentDate <= minDate;
      nextBtn.disabled = currentDate >= maxDate;
    };

    const updateProgressBar = () => {
      const progress = (pomodoroCycle / totalCycles) * 100;
      progressFill.style.width = `${progress}%`;
    };

    const updateProgressSummary = () => {
      const dateKey = getDateKey(currentDate);
      const slots = scheduleMap.get(dateKey);
      
      if (!slots) {
        progressSummary.textContent = "No study scheduled for today";
        return;
      }
      
      const total = slots.length;
      const completed = slots.filter((_, i) => 
        completedSlots.has(`${dateKey}-${i}`)
      ).length;
      const skipped = slots.filter((_, i) => 
        skippedSlots.has(`${dateKey}-${i}`)
      ).length;
      
      progressSummary.textContent = 
        `üìä Progress: ${completed}/${total} completed ‚Ä¢ ${skipped} skipped`;
    };

    const updateCatchUpList = () => {
      if (skippedSlots.size === 0) {
        catchUp.style.display = 'none';
        return;
      }
      
      catchUp.style.display = 'block';
      catchUpList.innerHTML = '';
      
      // Sort skipped slots by date
      const sortedSlots = Array.from(skippedSlots)
        .map(key => {
          const [dateKey, index] = key.split('-');
          const slot = scheduleMap.get(dateKey)?.[parseInt(index)];
          return { dateKey, index: parseInt(index), slot };
        })
        .filter(item => item.slot)
        .sort((a, b) => new Date(a.dateKey) - new Date(b.dateKey))
        .slice(0, 5);
      
      sortedSlots.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `
          <div>
            <strong>${item.slot.title}</strong>
            <div class="time">${item.slot.time}</div>
          </div>
          <div class="date">${formatDate(new Date(item.dateKey))}</div>
        `;
        li.addEventListener('click', () => {
          currentDate = new Date(item.dateKey);
          updateDateDisplay();
          renderGrid();
          openTimerModal(item.dateKey, item.index);
        });
        catchUpList.appendChild(li);
      });
    };

    // ==================== GRID RENDERING ====================
    function renderGrid() {
      grid.innerHTML = '';
      const dateKey = getDateKey(currentDate);
      const slots = scheduleMap.get(dateKey);

      if (!slots || slots.length === 0) {
        grid.innerHTML = '<div class="empty-state">üéâ No study scheduled today! Take a rest or revise previous topics.</div>';
        updateProgressSummary();
        updateCatchUpList();
        return;
      }

      slots.forEach((slot, index) => {
        const slotKey = `${dateKey}-${index}`;
        let status = 'pending';
        
        if (completedSlots.has(slotKey)) {
          status = 'completed';
        } else if (skippedSlots.has(slotKey)) {
          status = 'pending';
        } else if (slotKey === inProgressSlot) {
          status = 'in-progress';
        }
        
        const card = document.createElement('div');
        card.className = `card ${status}`;
        card.innerHTML = `
          <div class="card-header ${slot.type}">
            ${slot.type.toUpperCase()} FOCUS
            ${status === 'in-progress' ? '‚è≥' : ''}
          </div>
          <div class="card-body">
            <h3 class="card-title">${slot.title}</h3>
            <p class="card-desc">${slot.desc}</p>
            <div class="card-time">‚è∞ ${slot.time}</div>
            <p class="card-location">üìç Home Study</p>
            <div class="card-actions">
              ${status !== 'completed' ? `
                <button class="action-btn complete-btn" data-action="complete" data-key="${slotKey}">
                  ‚úì Mark Done
                </button>
                <button class="action-btn timer-btn" data-action="timer" data-key="${slotKey}">
                  ‚è±Ô∏è Start Timer
                </button>
                <button class="action-btn skip-btn" data-action="skip" data-key="${slotKey}">
                  ‚è≠Ô∏è Skip
                </button>
              ` : ''}
            </div>
          </div>
        `;
        
        // Add event listeners
        const buttons = card.querySelectorAll('[data-action]');
        buttons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const action = btn.dataset.action;
            const key = btn.dataset.key;
            
            if (action === 'complete') {
              markAsCompleted(key);
            } else if (action === 'timer') {
              const [dateKey, index] = key.split('-');
              openTimerModal(dateKey, parseInt(index));
            } else if (action === 'skip') {
              markAsSkipped(key);
            }
          });
        });
        
        // Card click opens modal
        card.addEventListener('click', () => {
          openTimerModal(dateKey, index);
        });
        
        grid.appendChild(card);
      });

      updateProgressSummary();
      updateCatchUpList();
    }

    // ==================== SLOT ACTIONS ====================
    function markAsCompleted(key) {
      completedSlots.add(key);
      skippedSlots.delete(key);
      if (key === inProgressSlot) inProgressSlot = null;
      saveProgress();
      renderGrid();
    }

    function markAsSkipped(key) {
      skippedSlots.add(key);
      completedSlots.delete(key);
      if (key === inProgressSlot) inProgressSlot = null;
      saveProgress();
      renderGrid();
    }

    // ==================== TIMER FUNCTIONS ====================
    function openTimerModal(dateKey, index) {
      const slots = scheduleMap.get(dateKey);
      if (!slots || !slots[index]) return;

      currentSlot = { slot: slots[index], index, dateKey };
      const slot = slots[index];

      // Update modal
      modalHeader.className = `modal-header ${slot.type}`;
      modalHeader.firstChild.textContent = `${slot.type.toUpperCase()} FOCUS`;
      
      slotInfo.innerHTML = `
        <h3 class="card-title">${slot.title}</h3>
        <p class="card-desc">${slot.desc}</p>
        <div class="card-time">‚è∞ ${slot.time}</div>
        <p class="card-location">üìç Home Study</p>
      `;

      resetTimer();
      modal.style.display = 'flex';
    }

    function startTimer(minutes, mode) {
      clearInterval(timerInterval);
      remainingTime = minutes * 60;
      isPaused = false;
      currentMode = mode;
      
      // Update UI
      timerLabel.textContent = mode === 'study' ? 'üìö Study Session' : '‚òï Break Time';
      pauseBtn.disabled = false;
      stopBtn.disabled = false;
      pauseBtn.textContent = '‚è∏Ô∏è Pause';
      
      // Update pomodoro cycle for study sessions
      if (mode === 'study') {
        pomodoroCycle = Math.min(pomodoroCycle + 1, totalCycles);
        updateProgressBar();
      }

      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        if (isPaused) return;
        
        remainingTime--;
        updateTimerDisplay();
        
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          playAlarm();
          timerLabel.textContent = 'Session Complete! üéâ';
          
          // Auto-mark as completed if study session finished
          if (mode === 'study' && currentSlot) {
            const slotKey = `${currentSlot.dateKey}-${currentSlot.index}`;
            markAsCompleted(slotKey);
          }
          
          // Reset pomodoro cycle after all cycles
          if (mode === 'study' && pomodoroCycle >= totalCycles) {
            pomodoroCycle = 0;
            updateProgressBar();
          }
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const hours = Math.floor(remainingTime / 3600);
      const minutes = Math.floor((remainingTime % 3600) / 60);
      const seconds = remainingTime % 60;
      timerDisplay.textContent = 
        `${hours.toString().padStart(2, '0')}:` +
        `${minutes.toString().padStart(2, '0')}:` +
        `${seconds.toString().padStart(2, '0')}`;
    }

    function resetTimer() {
      clearInterval(timerInterval);
      remainingTime = 0;
      isPaused = false;
      currentMode = null;
      pomodoroCycle = 0;
      inProgressSlot = null;
      
      timerDisplay.textContent = '00:00:00';
      timerLabel.textContent = 'Ready to start';
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      pauseBtn.textContent = '‚è∏Ô∏è Pause';
      updateProgressBar();
    }

    function playAlarm() {
      alarmSound.currentTime = 0;
      alarmSound.play().catch(e => console.log('Audio play failed:', e));
    }

    // ==================== EVENT LISTENERS ====================
    prevBtn.addEventListener('click', () => {
      currentDate.setDate(currentDate.getDate() - 1);
      updateDateDisplay();
      renderGrid();
    });

    nextBtn.addEventListener('click', () => {
      currentDate.setDate(currentDate.getDate() + 1);
      updateDateDisplay();
      renderGrid();
    });

    studyBtn.addEventListener('click', () => startTimer(45, 'study'));
    breakBtn.addEventListener('click', () => startTimer(15, 'break'));

    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
      timerLabel.textContent = isPaused ? '‚è∏Ô∏è Paused' : 'Timer Running';
    });

    stopBtn.addEventListener('click', resetTimer);

    completeBtn.addEventListener('click', () => {
      if (currentSlot) {
        const slotKey = `${currentSlot.dateKey}-${currentSlot.index}`;
        markAsCompleted(slotKey);
        closeModal();
      }
    });

    skipBtn.addEventListener('click', () => {
      if (currentSlot) {
        const slotKey = `${currentSlot.dateKey}-${currentSlot.index}`;
        markAsSkipped(slotKey);
        closeModal();
      }
    });

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    function closeModal() {
      resetTimer();
      modal.style.display = 'none';
    }

    // ==================== KEYBOARD SHORTCUTS ====================
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
      if (e.key === 'ArrowLeft' && !prevBtn.disabled) prevBtn.click();
      if (e.key === 'ArrowRight' && !nextBtn.disabled) nextBtn.click();
      if (e.key === ' ' && modal.style.display === 'flex') {
        e.preventDefault();
        pauseBtn.click();
      }
    });

    // ==================== INITIALIZATION ====================
    updateDateDisplay();
    updateSyncStatus('', 'Loading...');
    loadProgress(); // This will call renderGrid() when done

    // Initial render with local data while loading cloud data
    renderGrid();
  </script>
</body>
</html>